apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../vpcless

patches:
  - target:
      group: cluster.x-k8s.io
      version: v1beta1
      kind: Cluster
    patch: |-
      apiVersion: cluster.x-k8s.io/v1beta1
      kind: Cluster
      metadata:
        name: ${CLUSTER_NAME}
      spec:
        clusterNetwork:
          pods:
            cidrBlocks:
              - 10.192.0.0/10
              - fd02::/80
          services:
            cidrBlocks:
              - 10.96.0.0/12
              - fd03::/108
  - target:
      group: controlplane.cluster.x-k8s.io
      version: v1beta1
      kind: RKE2ControlPlane
    patch: |-
      apiVersion: controlplane.cluster.x-k8s.io/v1beta1
      kind: RKE2ControlPlane
      metadata:
        name: ${CLUSTER_NAME}-control-plane
      spec:
        serverConfig:
          ClusterCidr: "10.192.0.0/10,fd02::/80"
          ServiceCidr: "10.96.0.0/12,fd03::/108"
  - target:
      kind: HelmChartProxy
      name: .*-cilium
    patch: |-
      - op: add
        path: /spec/valuesTemplate
        value: |
          ipv6:
            enabled: true
