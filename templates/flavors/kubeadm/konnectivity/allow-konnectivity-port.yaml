apiVersion: v1
kind: ConfigMap
metadata:
  name: ${CLUSTER_NAME}-konnectivity-cilium-policy
data:
  cilium-policy.yaml: |-
    apiVersion: "cilium.io/v2"
    kind: CiliumClusterwideNetworkPolicy
    metadata:
      name: "allow-konnectivity-policy"
    spec:
      description: "allow incoming connections to konnectivity-server from everywhere"
      nodeSelector: {}
      ingress:
        - fromEntities:
            - world
          toPorts:
            - ports:
                - port: "8132"
---
apiVersion: addons.cluster.x-k8s.io/v1beta1
kind: ClusterResourceSet
metadata:
  name: ${CLUSTER_NAME}-konnectivity-cilium-policy
spec:
  clusterSelector:
    matchLabels:
      cluster: ${CLUSTER_NAME}
  resources:
    - kind: ConfigMap
      name: ${CLUSTER_NAME}-konnectivity-cilium-policy
  strategy: Reconcile